---
- name: Setting up application service
  user: root
  hosts: red, blue, green
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Remove locks
      ansible.builtin.file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /var/cache/apt/archives/lock
        - /var/lib/dpkg/lock-frontend
        - /var/lib/apt/lists/lock
        - /var/lib/dpkg/lock
    - name: Fix dpkg
      ansible.builtin.shell:
        cmd: dpkg --configure -a
    - name: Adding Gcreds
      ansible.builtin.copy:
        src: ~/gcreds.json
        dest: /usr/share/.gcreds
        group: docker
        owner: nomad

